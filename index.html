<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>XJSON • JSON ASX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icon-192.png" />
  <link rel="stylesheet" href="./style.css" />
  <!-- Google Sign-In (keeps your existing auth.js flow) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons/dist/feather.min.js" defer></script>
</head>
<body>
  <div id="appRoot" class="shell">
    <!-- Pinned neon icon sidebar (W2 ~82px) -->
    <aside class="sidebar">
      <div class="brand">
        <img src="./json-asx.jpg" alt="JSON ASX" />
      </div>
      <nav class="nav">
        <button class="nav-btn" data-route="/" data-title="Home">
          <i data-feather="home"></i>
        </button>
        <button class="nav-btn" data-route="/store/" data-title="Store">
          <i data-feather="shopping-bag"></i>
        </button>
        <button class="nav-btn" data-route="/library/" data-title="Library">
          <i data-feather="grid"></i>
        </button>
        <button class="nav-btn" data-route="/downloads/" data-title="Downloads">
          <i data-feather="download"></i>
        </button>
        <button class="nav-btn" data-route="/settings/" data-title="Settings">
          <i data-feather="settings"></i>
        </button>
        <div class="spacer"></div>
        <!-- Open Builder -->
        <button id="openBuilder" class="nav-btn" data-title="Builder">
          <i data-feather="code"></i>
        </button>
      </nav>
    </aside>

    <!-- Topbar (compact, no hamburger) -->
    <header class="topbar">
      <div class="channels">
        <span class="chip active" data-channel="latest">latest</span>
        <span class="chip" data-channel="stable">stable</span>
        <span class="chip" data-channel="nightly">nightly</span>
      </div>
      <div class="actions">
        <input id="q" class="search" placeholder="Search…" />
        <div id="googleBtn"></div>
        <input id="pat" class="pat" placeholder="Admin GitHub PAT" />
        <button id="savePat" class="btn">Save PAT</button>
        <button id="refresh" class="btn">Refresh</button>
      </div>
    </header>

    <!-- Main content (apps render here; preview is the content) -->
    <main id="main" class="content">
      <div class="boot-msg">Loading XJSON…</div>
    </main>

    <!-- Slide-over Builder (B1). On mobile becomes full-screen modal. -->
    <aside id="builder" class="builder hidden">
      <div class="builder-header">
        <div class="tabs">
          <button class="tab active" data-tab="editor">Editor</button>
          <button class="tab" data-tab="ai">AI</button>
        </div>
        <button id="closeBuilder" class="icon-btn" title="Close Builder">
          <i data-feather="x"></i>
        </button>
      </div>

      <div class="builder-body">
        <!-- Editor tab -->
        <section class="tab-panel" data-tab-panel="editor">
          <div class="row">
            <select id="builderTarget"><option value="">Select JSON App…</option></select>
            <button id="saveApp" class="btn">Save</button>
            <button id="publishBtn" class="btn">Publish</button>
          </div>
          <textarea id="appJson" class="code" spellcheck="false"></textarea>
        </section>

        <!-- AI tab -->
        <section class="tab-panel hidden" data-tab-panel="ai">
          <div class="row">
            <input id="langflowUrl" placeholder="LangFlow endpoint (POST) e.g. https://…/api/v1/run" />
          </div>
          <div class="row">
            <input id="chatInput" placeholder="Describe a change (we’ll apply it, not paste code)" />
            <button id="chatSend" class="btn">Apply</button>
          </div>
          <div id="chatLog" class="chat-log"></div>
        </section>
      </div>
    </aside>

    <!-- Fullscreen prompt (20s) for subdomains -->
    <div id="fsOffer" class="fs-offer hidden">
      <span>Tip: Fullscreen for best experience</span>
      <button id="fsGo" class="btn">Go Fullscreen</button>
      <button id="fsDismiss" class="btn">Dismiss</button>
    </div>
  </div>

  <!-- App logic -->
  <script type="module" src="./app.js"></script>
  <script>
    // Activate feather icons after DOM
    document.addEventListener('DOMContentLoaded', () => {
      if (window.feather) window.feather.replace();
    });
  </script>
</body>
</html>
