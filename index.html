<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>XJSON HUD ‚Äî Matrix Modal Demo</title>
<style>
  :root{
    --bg:#000;
    --glass: rgba(8,8,10,0.6);
    --glass-2: rgba(0,0,0,0.7);
    --neon:#00ff6a;
    --neon-2:#00f0ff;
    --muted:#9aa;
    --glass-border: rgba(255,255,255,0.06);
    --accent: linear-gradient(90deg,var(--neon),var(--neon-2));
    --ui-pad:12px;
    font-family: Inter, "Segoe UI", Roboto, system-ui, monospace;
    color: #dfffdc;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#000 0%, #040404 60%);}
  /* HUD Shell layout */
  .hud-shell{display:grid;grid-template-columns:260px 1fr;grid-template-rows:72px 1fr;gap:14px;padding:16px;height:100%;}
  .sidebar{grid-row:1 / span 2;background:linear-gradient(180deg, rgba(0,0,0,.6), rgba(0,0,0,.55));backdrop-filter: blur(6px);border-radius:18px;padding:18px;border:1px solid var(--glass-border);box-shadow:0 6px 30px rgba(0,0,0,0.7)}
  .topbar{grid-column:2;background:transparent;display:flex;align-items:center;justify-content:space-between;padding:8px 18px;gap:12px}
  .content{grid-column:2;grid-row:2;background:linear-gradient(180deg, rgba(6,6,6,0.5), rgba(0,0,0,0.35));border-radius:14px;padding:18px;border:1px solid var(--glass-border);overflow:auto}
  h1{margin:0;font-size:18px;letter-spacing:.6px;color:#ccefcd}
  .logo{display:flex;align-items:center;gap:12px;cursor:pointer}
  .logo .mark{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#030 0%, #001 70%);box-shadow:0 4px 12px rgba(0,255,106,.08);border:1px solid rgba(0,255,106,0.06);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--neon);font-size:18px}
  .nav{margin-top:18px;display:flex;flex-direction:column;gap:8px}
  .nav button{background:transparent;border:1px solid rgba(255,255,255,.03);padding:10px;border-radius:10px;color:var(--muted);text-align:left;cursor:pointer}
  .nav button:hover{color:var(--neon);box-shadow:0 6px 18px rgba(0,255,106,.03);border-color:rgba(0,255,106,.08)}
  .action-row{display:flex;gap:8px;align-items:center}
  .btn{padding:9px 12px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:linear-gradient(180deg,rgba(255,255,255,.02),transparent);color:var(--neon);cursor:pointer}
  .btn.secondary{color:var(--muted);border-style:dashed}
  .hud-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.0));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .muted{color:var(--muted);font-size:12px}
  footer{color:var(--muted);font-size:12px;margin-top:18px}

  /* MATRIX MODAL */
  .matrix-modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999}
  .matrix-modal-backdrop.active{display:flex}
  .matrix-canvas{position:absolute;inset:0;z-index:9998;mix-blend-mode:screen;opacity:.85;pointer-events:none}
  .matrix-modal{position:relative;z-index:10000;width:min(980px,96%);max-height:92vh;border-radius:14px;background:linear-gradient(180deg, rgba(8,8,10,0.76), rgba(0,0,0,0.82));border:1px solid rgba(255,255,255,0.04);box-shadow:0 30px 120px rgba(0,0,0,0.8);overflow:hidden;display:flex;flex-direction:column}
  .matrix-header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid rgba(255,255,255,0.02)}
  .matrix-title{display:flex;gap:12px;align-items:center}
  .glass-ctrl{border-radius:10px;padding:8px 12px;background:linear-gradient(90deg, rgba(0,0,0,0.25), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.03);color:var(--neon)}
  .matrix-body{display:flex;gap:16px;align-items:flex-start;padding:18px}
  .matrix-sidebar{width:240px;display:flex;flex-direction:column;gap:8px}
  .matrix-main{flex:1;min-height:320px;background:linear-gradient(180deg,rgba(0,0,0,0.2),rgba(10,10,10,0.2));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .tabrow{display:flex;gap:8px;margin-bottom:12px}
  .tabrow button{padding:8px 10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.02);color:var(--muted);cursor:pointer}
  .tabrow button.active{color:var(--neon);border-color:rgba(0,255,106,0.08);box-shadow:0 12px 30px rgba(0,255,106,0.03)}
  textarea.token-input{width:100%;height:120px;border-radius:8px;padding:10px;background:#060606;color:#bff9c6;border:1px solid rgba(0,255,106,0.04)}
  .tiny{font-size:12px;color:var(--muted)}
  .hidden-hotspot{position:fixed;right:6px;bottom:6px;width:28px;height:28px;opacity:0.02;z-index:50;cursor:pointer}

  /* responsive */
  @media (max-width:820px){
    .hud-shell{grid-template-columns:72px 1fr;grid-template-rows:72px 1fr}
    .sidebar{border-radius:10px;padding:10px}
    .matrix-modal{width:96%}
    .matrix-sidebar{display:none}
  }
</style>
</head>
<body>

<div class="hud-shell" id="hudRoot">
  <aside class="sidebar">
    <div class="logo" id="logo">
      <div class="mark">X</div>
      <div>
        <h1>XJSON OS</h1>
        <div class="muted">XJSON ‚Ä¢ Hybrid Runtime</div>
      </div>
    </div>

    <div class="nav" style="margin-top:14px">
      <button id="btn-store">üè† Home</button>
      <button id="btn-store2">üõí Store</button>
      <button id="btn-library">üéÆ Library</button>
      <button id="btn-editor" class="btn secondary">‚úèÔ∏è Editor</button>
      <button id="btn-matrix" class="btn">üåê Matrix</button>
    </div>

    <div style="margin-top:18px" class="action-row">
      <button id="signin-btn" class="btn">Sign in (Google)</button>
      <button id="settings-btn" class="btn secondary">Settings</button>
    </div>

    <div style="margin-top:22px" class="card muted">
      <div>Latest</div>
      <div style="font-weight:700;color:var(--neon)">v1.0.0</div>
      <div class="muted" style="margin-top:4px">Stable ‚Ä¢ json-2d</div>
    </div>

    <footer>
      <div class="muted">Build: Flash Zombie HUD</div>
    </footer>
  </aside>

  <header class="topbar">
    <div><strong style="letter-spacing:1px">XJSON ‚Ä¢ Launcher</strong></div>
    <div style="display:flex;gap:8px;align-items:center">
      <div class="muted">User: <span id="uid">guest</span></div>
      <button id="btn-full" class="btn">‚§¢</button>
    </div>
  </header>

  <main class="content">
    <div class="hud-grid">
      <div class="card">
        <h3>Now Playing</h3>
        <div class="muted">Starter Clicker ‚Ä¢ Demo</div>
      </div>
      <div class="card">
        <h3>Library</h3>
        <div class="muted">2 apps</div>
      </div>
      <div class="card">
        <h3>Store Picks</h3>
        <div class="muted">Featured JSON games</div>
      </div>
      <div class="card">
        <h3>System</h3>
        <div class="muted">SW: <span id="sw-status">unknown</span></div>
      </div>
    </div>
  </main>
</div>

<!-- Hidden (tiny) hotspot for extra-sneaky access -->
<div class="hidden-hotspot" id="hotspot" title="secret"></div>

<!-- MATRIX MODAL -->
<div class="matrix-modal-backdrop" id="matrixModal">
  <canvas id="matrixCanvas" class="matrix-canvas"></canvas>

  <div class="matrix-modal" role="dialog" aria-modal="true" aria-label="Matrix Modal">
    <div class="matrix-header">
      <div class="matrix-title">
        <div class="glass-ctrl">‚§¢ XJSON ‚Ä¢ MATRIX</div>
        <div style="font-weight:700;color:var(--neon);margin-left:8px">Under the Glass ‚Äî System Control</div>
      </div>
      <div>
        <button id="modal-close" class="btn">‚úñ</button>
      </div>
    </div>

    <div class="matrix-body">
      <aside class="matrix-sidebar">
        <button class="glass-ctrl" data-tab="login">Google Login</button>
        <button class="glass-ctrl" data-tab="settings">Settings</button>
        <button class="glass-ctrl" data-tab="tokens">Tokens</button>
        <button class="glass-ctrl" data-tab="apis">APIs</button>
        <button class="glass-ctrl" data-tab="cdns">CDNs</button>
        <button class="glass-ctrl" data-tab="widgets">Widgets</button>
      </aside>

      <section class="matrix-main" id="matrixMain">
        <div class="tabrow" id="tabrow">
          <button class="active">Quick</button>
        </div>

        <!-- TABS CONTENT -->
        <div id="tabContent">
          <!-- LOGIN -->
          <div id="tab-login">
            <h3 style="color:var(--neon)">Google Sign-In</h3>
            <p class="tiny">Use your Google account to provision your UID-C and vault. Replace <code>YOUR_GOOGLE_CLIENT_ID</code> with your client id.</p>
            <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
              <button id="googleSign" class="btn">Sign in with Google</button>
              <button id="googleSignPopup" class="btn secondary">Popup (advanced)</button>
            </div>
            <div style="margin-top:12px" class="muted tiny">
              After sign-in the token will appear in Tokens ‚Üí You should store it safely in your vault (localStorage / cloud vault).
            </div>
          </div>

          <!-- SETTINGS -->
          <div id="tab-settings" style="display:none">
            <h3 style="color:var(--neon)">UI & Runtime</h3>
            <label class="tiny">Theme</label>
            <div style="display:flex;gap:8px;margin-bottom:12px">
              <button class="btn" id="theme-dark">Glass Black</button>
              <button class="btn" id="theme-neon">Neon Matrix</button>
            </div>
            <label class="tiny">Fullscreen prompt</label>
            <div style="margin-top:6px">
              <button class="btn" id="fs-on">Enable (20s prompt)</button>
              <button class="btn secondary" id="fs-off">Disable</button>
            </div>
          </div>

          <!-- TOKENS -->
          <div id="tab-tokens" style="display:none">
            <h3 style="color:var(--neon)">Tokens & Secrets</h3>
            <p class="tiny muted">Paste tokens here for the current user (localStorage). <strong>Do not commit this file.</strong></p>
            <textarea id="tokensArea" class="token-input" placeholder="Paste PATs / API tokens here (kept in localStorage)"></textarea>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="saveTokens" class="btn">Save</button>
              <button id="clearTokens" class="btn secondary">Clear</button>
            </div>
          </div>

          <!-- APIS -->
          <div id="tab-apis" style="display:none">
            <h3 style="color:var(--neon)">APIs</h3>
            <p class="tiny">Add endpoints and headers to be used by the AI tab or editors.</p>
            <label class="tiny">Endpoint URL</label>
            <input id="api-url" style="width:100%;padding:8px;border-radius:8px;background:#070707;color:#cfffb2;border:1px solid rgba(255,255,255,0.03)">
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="saveApi" class="btn">Save</button>
              <button id="testApi" class="btn secondary">Test</button>
            </div>
            <div id="apiResult" class="muted tiny" style="margin-top:8px"></div>
          </div>

          <!-- CDNs -->
          <div id="tab-cdns" style="display:none">
            <h3 style="color:var(--neon)">CDN Overrides</h3>
            <p class="tiny">Add CDN mirrors (e.g. fallback assets or forks).</p>
            <input id="cdn-url" style="width:100%;padding:8px;border-radius:8px;background:#070707;color:#cfffb2;border:1px solid rgba(255,255,255,0.03)">
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="saveCdn" class="btn">Save</button>
            </div>
          </div>

          <!-- WIDGETS -->
          <div id="tab-widgets" style="display:none">
            <h3 style="color:var(--neon)">Widgets</h3>
            <p class="tiny">Inject small UI components into HUD (clock, debug OBD, logs).</p>
            <div style="display:flex;gap:8px;margin-top:12px">
              <button id="widget-clock" class="btn">Clock</button>
              <button id="widget-logs" class="btn secondary">Debug Log</button>
            </div>
            <div id="widgetArea" style="margin-top:12px"></div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<!-- scripts -->
<script>
/* -------------------------
   Modal + Matrix init
   ------------------------- */
const modal = document.getElementById('matrixModal');
const matrixCanvas = document.getElementById('matrixCanvas');
const ctx = matrixCanvas.getContext?.('2d');

function setCanvasSize(){
  matrixCanvas.width = window.innerWidth;
  matrixCanvas.height = window.innerHeight;
}
setCanvasSize();
window.addEventListener('resize', setCanvasSize);

let matrixCols = [];
let matrixInterval = null;
function startMatrix(){
  if (!ctx) return;
  const cols = Math.floor(window.innerWidth / 14);
  const rows = Math.floor(window.innerHeight / 16);
  matrixCols = new Array(cols).fill(0).map(()=>Math.random()*rows);
  ctx.clearRect(0,0,matrixCanvas.width,matrixCanvas.height);
  matrixInterval = setInterval(()=> {
    ctx.fillStyle = 'rgba(0,0,0,0.25)';
    ctx.fillRect(0,0,matrixCanvas.width,matrixCanvas.height);
    ctx.fillStyle = '#00ff6a';
    ctx.font = '14px monospace';
    for (let i=0;i<cols;i++){
      const x = i*14;
      let y = matrixCols[i]*16;
      const char = String.fromCharCode(33 + Math.floor(Math.random()*94));
      ctx.fillText(char, x, y);
      matrixCols[i] += 0.8 + Math.random()*0.9;
      if (matrixCols[i] > rows) matrixCols[i] = 0;
    }
  }, 40);
}
function stopMatrix(){
  if (matrixInterval) { clearInterval(matrixInterval); matrixInterval = null; ctx.clearRect(0,0,matrixCanvas.width,matrixCanvas.height); }
}

/* show/hide modal */
function openMatrix(){
  modal.classList.add('active');
  startMatrix();
}
function closeMatrix(){
  modal.classList.remove('active');
  stopMatrix();
}
document.getElementById('modal-close').addEventListener('click', closeMatrix);
document.getElementById('btn-matrix').addEventListener('click', openMatrix);

/* sneaky triggers */
let logoClicks = 0;
let logoTimer = null;
document.getElementById('logo').addEventListener('click', () => {
  logoClicks++;
  if (logoTimer) clearTimeout(logoTimer);
  logoTimer = setTimeout(()=>{ logoClicks=0; }, 1200);
  if (logoClicks >= 3) { openMatrix(); logoClicks=0; }
});
document.getElementById('hotspot').addEventListener('dblclick', openMatrix);
window.addEventListener('keydown', (e) => { if (e.ctrlKey && e.key.toLowerCase()==='m') openMatrix(); });

/* link other entry points (editor, signin) */
document.getElementById('signin-btn').addEventListener('click', () => { openMatrix(); showTab('login'); });
document.getElementById('settings-btn').addEventListener('click', () => { openMatrix(); showTab('settings'); });

/* -------------------------
   Tabs
   ------------------------- */
function hideAllTabs(){
  ['login','settings','tokens','apis','cdns','widgets'].forEach(t => {
    const el = document.getElementById('tab-' + t);
    if (el) el.style.display = 'none';
  });
}
function showTab(name){
  hideAllTabs();
  const el = document.getElementById('tab-' + name);
  if (el) el.style.display = 'block';
}
document.querySelectorAll('[data-tab]').forEach(btn => {
  btn.addEventListener('click', (e) => { showTab(e.currentTarget.dataset.tab); });
});
showTab('login');

/* -------------------------
   Token storage
   ------------------------- */
const tokensArea = document.getElementById('tokensArea');
const saveTokensBtn = document.getElementById('saveTokens');
const clearTokensBtn = document.getElementById('clearTokens');
saveTokensBtn.addEventListener('click', ()=> {
  localStorage.setItem('xjson.tokens', tokensArea.value);
  alert('Tokens saved to localStorage (for demo).');
});
clearTokensBtn.addEventListener('click', ()=> { localStorage.removeItem('xjson.tokens'); tokensArea.value=''; alert('Tokens cleared'); });
tokensArea.value = localStorage.getItem('xjson.tokens')||'';

/* -------------------------
   API testing & CDNs
   ------------------------- */
document.getElementById('saveApi').addEventListener('click', ()=> {
  const url = document.getElementById('api-url').value.trim();
  if (!url) return alert('add url');
  localStorage.setItem('xjson.api.url', url);
  document.getElementById('apiResult').textContent = 'Saved: '+url;
});
document.getElementById('testApi').addEventListener('click', async ()=>{
  const url = localStorage.getItem('xjson.api.url');
  if (!url) return alert('no API set');
  try {
    const r = await fetch(url, { method:'GET' });
    const txt = await r.text();
    document.getElementById('apiResult').textContent = `Status ${r.status} ‚Äî ${txt.slice(0,180)}`;
  } catch (e) {
    document.getElementById('apiResult').textContent = 'Error: '+e.message;
  }
});
document.getElementById('saveCdn').addEventListener('click', ()=> {
  const c = document.getElementById('cdn-url').value.trim();
  if (!c) return alert('add cdn');
  localStorage.setItem('xjson.cdn', c);
  alert('CDN saved');
});

/* -------------------------
   Widgets
   ------------------------- */
document.getElementById('widget-clock').addEventListener('click', ()=> {
  const w = document.getElementById('widgetArea');
  w.innerHTML = '<div style="font-weight:700;color:var(--neon)">'+ new Date().toLocaleTimeString() +'</div>';
});
document.getElementById('widget-logs').addEventListener('click', ()=> {
  const w = document.getElementById('widgetArea');
  w.innerHTML = '<pre class="tiny" style="white-space:pre-wrap;max-height:160px;overflow:auto">Logs: demo log line 1\nline2\nline3</pre>';
});

/* -------------------------
   Google OAuth (popup + callback)
   ------------------------- */
const GOOGLE_CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID'; // <<< REPLACE THIS with your client id
const OAUTH_REDIRECT = location.origin + '/oauth-callback.html';

function openAuthPopupAuthURL(url, name='xjson-auth'){
  const w = 700, h = 650;
  const left = (screen.width/2) - (w/2);
  const top = (screen.height/2) - (h/2);
  const popup = window.open(url, name, `width=${w},height=${h},top=${top},left=${left}`);
  if (!popup) return alert('Popup blocked - allow popups for this site');
  // listen for postMessage from callback
  window.addEventListener('message', function onMsg(ev){
    if (ev.origin !== location.origin) return;
    if (ev.data && ev.data.xjson_oauth) {
      const token = ev.data.xjson_oauth;
      // put token into the tokens area & save
      tokensArea.value = token;
      localStorage.setItem('xjson.tokens', token);
      alert('Google token received (demo).');
      window.removeEventListener('message', onMsg);
    }
  }, { once: true });
}

document.getElementById('googleSign').addEventListener('click', ()=> {
  // build implicit OAuth URL (demo)
  if (!GOOGLE_CLIENT_ID || GOOGLE_CLIENT_ID === 'YOUR_GOOGLE_CLIENT_ID') return alert('Set GOOGLE_CLIENT_ID inside the page.');
  const scope = encodeURIComponent('openid email profile');
  const redirect = encodeURIComponent(OAUTH_REDIRECT);
  const url = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${GOOGLE_CLIENT_ID}&redirect_uri=${redirect}&response_type=token&scope=${scope}&prompt=consent&include_granted_scopes=true`;
  openAuthPopupAuthURL(url);
});
document.getElementById('googleSignPopup').addEventListener('click', ()=> {
  document.getElementById('googleSign').click();
});

/* -------------------------
   Show SW status
   ------------------------- */
if (navigator.serviceWorker && navigator.serviceWorker.controller) {
  document.getElementById('sw-status').textContent = 'active';
} else {
  document.getElementById('sw-status').textContent = 'inactive';
}

/* full-screen convenience (20s popup prompt idea) */
document.getElementById('btn-full').addEventListener('click', async ()=> {
  if (!document.fullscreenElement) {
    try {
      await document.documentElement.requestFullscreen();
    } catch(e){ console.warn(e); }
  } else {
    document.exitFullscreen();
  }
});

/* small UX: open matrix on first time (optional) */
// if(!localStorage.getItem('xjson.sawMatrix')){ setTimeout(()=>{ openMatrix(); localStorage.setItem('xjson.sawMatrix', '1');}, 1400); }
</script>
</body>
</html>
