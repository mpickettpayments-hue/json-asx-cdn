<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>XJSON • JSON ASX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icon-192.png" />
  <link rel="stylesheet" href="./style.css" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://unpkg.com/feather-icons/dist/feather.min.js" defer></script>
  <style>
    .ed-tabs{display:flex;gap:8px;margin-bottom:10px}
    .ed-tab{background:#0f1720;border:1px solid #1b2940;color:#cfe3f4;border-radius:8px;padding:8px 12px;cursor:pointer}
    .ed-tab.active,.ed-tab:hover{background:#142438;border-color:#244b71}
    .ed-panel{display:none}
    .ed-panel.show{display:block}
    .file-hint{font-size:12px;color:#9fb8ce;margin:6px 0 0}
  </style>
</head>
<body>
  <div id="appRoot" class="shell">
    <!-- Sidebar with dynamic logo (L1) -->
    <aside class="sidebar">
      <div class="brand">
        <img id="brandLogo" alt="XJSON" />
      </div>
      <nav class="nav">
        <button class="nav-btn" data-route="/" data-title="Home"><i data-feather="home"></i></button>
        <button class="nav-btn" data-route="/store/" data-title="Store"><i data-feather="shopping-bag"></i></button>
        <button class="nav-btn" data-route="/library/" data-title="Library"><i data-feather="grid"></i></button>
        <button class="nav-btn" data-route="/downloads/" data-title="Downloads"><i data-feather="download"></i></button>
        <button class="nav-btn" data-route="/settings/" data-title="Settings"><i data-feather="settings"></i></button>
        <div class="spacer"></div>
        <button class="nav-btn" data-route="/editor/" data-title="Editor"><i data-feather="code"></i></button>
        <button class="nav-btn" data-route="/guide/" data-title="User Guide"><i data-feather="book"></i></button>
      </nav>
    </aside>

    <!-- TB2 -->
    <header class="topbar">
      <div class="channels">
        <span class="chip active" data-channel="latest">latest</span>
        <span class="chip" data-channel="stable">stable</span>
        <span class="chip" data-channel="nightly">nightly</span>
      </div>
      <div class="actions">
        <input id="q" class="search" placeholder="Search…" />
        <button id="refresh" class="btn">Refresh</button>
        <button id="debugBtn" class="btn">Debug</button>
        <div id="googleBtn" title="Sign in"></div>
        <button id="profileBtn" class="icon-btn" title="Profile"><i data-feather="user"></i></button>
      </div>
    </header>

    <main id="main" class="content">
      <div class="boot-msg">Loading XJSON…</div>
    </main>

    <!-- Fullscreen prompt -->
    <div id="fsOffer" class="fs-offer hidden">
      <span>Tip: Fullscreen for best experience</span>
      <button id="fsGo" class="btn">Go Fullscreen</button>
      <button id="fsDismiss" class="btn">Dismiss</button>
    </div>

    <!-- Debug overlay -->
    <div id="debugPanel" class="debug-panel hidden">
      <div class="debug-header">
        <strong>System Debug</strong>
        <button id="closeDebug" class="icon-btn"><i data-feather="x"></i></button>
      </div>
      <div class="debug-body">
        <div class="card"><pre id="osMeta">meta: (not loaded)</pre></div>
        <div class="card">
          <h3 class="h3">Error feed (auto)</h3>
          <table class="dbg-table" id="errorTable">
            <thead><tr><th>Time</th><th>Type</th><th>Message</th><th>Source</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="card">
          <h3 class="h3">Last Fetch</h3>
          <pre id="lastFetch">none</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- App logic -->
  <script type="module" src="./app.js"></script>
  <script>
    // Dynamic logo that is safe on GH Pages subpaths & custom domains
    (function(){
      function repoBasePath(){
        if (location.hostname.endsWith('github.io')) {
          const seg = location.pathname.split('/').filter(Boolean)[0] || '';
          return `/${seg}`;
        }
        return ''; // custom domains: root
      }
      const base = repoBasePath();
      const logo = document.getElementById('brandLogo');
      if (logo) {
        logo.src = `${base}/logo.png`;
        logo.onerror = ()=> { logo.onerror=null; logo.src = `${base}/icon-192.png`; };
      }
    })();
    document.addEventListener('DOMContentLoaded', ()=> { if (window.feather) window.feather.replace(); });
  </script>
</body>
</html>
