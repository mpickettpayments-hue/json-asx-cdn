{
  "@asx": "1.0.0",
  "@scene": "retro-start-screen",
  "@engine": "json-2d",
  "@theme": {
    "mode": "glass-black",
    "primary": "#00ff6a",
    "accent": "#00f0ff",
    "muted": "#9aa",
    "surface": "rgba(0,0,0,0.72)",
    "particleGlow": true
  },

  "@state": {
    "dock": null,
    "selectedRomId": null,
    "likes": {},
    "pins": {},
    "comments": {},
    "registryUrl": "./os/arcade-registry.json",
    "roms": []
  },

  "@data": [
    {
      "id": "registry",
      "type": "json",
      "src": "${state.registryUrl}",
      "into": "state.roms",
      "map": "roms"
    }
  ],

  "@ui": {
    "type": "column",
    "style": {
      "gap": 14,
      "pad": 16,
      "backdrop": "particles", 
      "height": "100vh",
      "overflow": "hidden"
    },
    "children": [
      {
        "id": "dockBanner",
        "type": "container",
        "style": {
          "display": "grid",
          "gridTemplateColumns": "92px 1fr auto",
          "alignItems": "center",
          "gap": 12,
          "pad": 12,
          "border": "1px solid rgba(255,255,255,0.06)",
          "radius": 12,
          "background": "linear-gradient(180deg, rgba(10,10,10,0.65), rgba(0,0,0,0.55))",
          "shadow": "0 20px 80px rgba(0,0,0,0.45)"
        },
        "children": [
          {
            "type": "image",
            "src": "${state.dock?.thumb || './public/placeholders/holotape.png'}",
            "style": { "width": 92, "height": 92, "radius": 10, "border": "1px solid rgba(255,255,255,0.06)", "objectFit": "cover" }
          },
          {
            "type": "vstack",
            "style": { "gap": 6 },
            "children": [
              {
                "type": "text",
                "value": "${state.dock ? state.dock.title : 'HOLOTAPE DOCK'}",
                "style": { "size": 18, "weight": 700, "color": "#c8ffd7", "letterSpacing": 0.4 }
              },
              {
                "type": "text",
                "value": "${state.dock ? 'HOLOTAPE READY' : 'LOAD HOLOTAPE'}",
                "style": { "size": 12, "color": "${state.dock ? '#00ff6a' : '#9aa'}" }
              },
              {
                "type": "text",
                "value": "${state.dock?.desc || 'Insert a holotape from the feed below to begin.'}",
                "style": { "size": 12, "color": "#9aa" }
              }
            ]
          },
          {
            "type": "hstack",
            "style": { "gap": 8 },
            "children": [
              {
                "id": "btnInsert",
                "type": "button",
                "label": "INSERT",
                "disabled": "${!state.selectedRomId}",
                "onClick": "dockSelected",
                "style": {
                  "pad": "10px 16px",
                  "radius": 10,
                  "bg": "linear-gradient(180deg, rgba(0,255,106,0.18), rgba(0,0,0,0.1))",
                  "border": "1px solid rgba(0,255,106,0.35)",
                  "color": "#00ff6a",
                  "glow": true
                }
              },
              {
                "id": "btnStart",
                "type": "button",
                "label": "START",
                "disabled": "${!state.dock}",
                "onClick": "startDocked",
                "style": {
                  "pad": "10px 16px",
                  "radius": 10,
                  "bg": "linear-gradient(180deg, rgba(0,240,255,0.18), rgba(0,0,0,0.1))",
                  "border": "1px solid rgba(0,240,255,0.35)",
                  "color": "#00f0ff"
                }
              }
            ]
          }
        ]
      },

      {
        "type": "spacer",
        "style": { "h": 8 }
      },

      {
        "id": "feedList",
        "type": "scroll",
        "style": { "flex": 1, "radius": 12, "border": "1px solid rgba(255,255,255,0.06)", "pad": 12, "overflow": "auto" },
        "forEach": {
          "of": "${state.roms}",
          "as": "rom",
          "key": "${rom.id}",
          "item": {
            "type": "container",
            "style": {
              "display": "grid",
              "gridTemplateColumns": "120px 1fr auto",
              "alignItems": "center",
              "gap": 14,
              "pad": 12,
              "radius": 10,
              "border": "1px solid rgba(255,255,255,0.05)",
              "background": "linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.08))",
              "hoverGlow": true,
              "marginBottom": 10
            },
            "children": [
              {
                "type": "image",
                "src": "${rom.thumb || './public/placeholders/rom.png'}",
                "alt": "${rom.title}",
                "style": { "width": 120, "height": 90, "radius": 8, "border": "1px solid rgba(255,255,255,0.06)", "objectFit": "cover" }
              },
              {
                "type": "vstack",
                "style": { "gap": 6 },
                "children": [
                  {
                    "type": "hstack",
                    "style": { "gap": 8, "align": "center" },
                    "children": [
                      { "type": "text", "value": "${rom.title}", "style": { "size": 16, "weight": 700, "color": "#eaffea" } },
                      { "type": "badge", "text": "${rom.badge || 'ROM'}", "style": { "color": "#00ff6a", "border": "1px solid rgba(0,255,106,0.35)" } }
                    ]
                  },
                  { "type": "text", "value": "${rom.desc || ''}", "style": { "size": 12, "color": "#9aa" } },
                  {
                    "type": "hstack",
                    "style": { "gap": 10, "wrap": true },
                    "children": [
                      { "type": "tag", "text": "${rom.genre || 'Arcade'}" },
                      { "type": "tag", "text": "${rom.engine || 'json-2d'}" },
                      { "type": "tag", "text": "v${rom.version || '1.0'}" }
                    ]
                  }
                ]
              },
              {
                "type": "vstack",
                "style": { "gap": 8, "align": "end" },
                "children": [
                  {
                    "type": "hstack",
                    "style": { "gap": 8 },
                    "children": [
                      {
                        "type": "button",
                        "label": "DOCK",
                        "onClick": "selectRom",
                        "args": { "id": "${rom.id}" },
                        "style": {
                          "pad": "8px 12px",
                          "radius": 10,
                          "bg": "transparent",
                          "border": "1px dashed rgba(0,255,106,0.35)",
                          "color": "#00ff6a"
                        }
                      },
                      {
                        "type": "button",
                        "label": "PLAY",
                        "onClick": "quickStart",
                        "args": { "id": "${rom.id}" },
                        "style": {
                          "pad": "8px 12px",
                          "radius": 10,
                          "bg": "transparent",
                          "border": "1px solid rgba(0,240,255,0.35)",
                          "color": "#00f0ff"
                        }
                      }
                    ]
                  },
                  {
                    "type": "hstack",
                    "style": { "gap": 8, "align": "center" },
                    "children": [
                      {
                        "type": "iconButton",
                        "icon": "thumbs-up",
                        "active": "${state.likes[rom.id] === true}",
                        "onClick": "toggleLike",
                        "args": { "id": "${rom.id}" },
                        "style": { "color": "${state.likes[rom.id] ? '#00ff6a' : '#9aa'}" }
                      },
                      {
                        "type": "iconButton",
                        "icon": "message-circle",
                        "onClick": "openComments",
                        "args": { "id": "${rom.id}" },
                        "style": { "color": "#9aa" }
                      },
                      {
                        "type": "iconButton",
                        "icon": "pin",
                        "active": "${state.pins[rom.id] === true}",
                        "onClick": "togglePin",
                        "args": { "id": "${rom.id}" },
                        "style": { "color": "${state.pins[rom.id] ? '#00ff6a' : '#9aa'}" }
                      }
                    ]
                  }
                ]
              }
            ]
          }
        }
      }
    ]
  },

  "@actions": {
    "selectRom": [
      { "set": "state.selectedRomId", "to": "${args.id}" }
    ],
    "dockSelected": [
      { "let": { "id": "${state.selectedRomId}" } },
      { "guard": "${!!let.id}", "then": [
        { "let": { "rom": "${state.roms.find(r=>r.id===let.id)}" } },
        { "set": "state.dock", "to": "${let.rom}" }
      ]}
    ],
    "startDocked": [
      { "guard": "${!!state.dock}", "then": [
        { "call": "arcade.play", "args": { "id": "${state.dock.id}" } }
      ]}
    ],
    "quickStart": [
      { "call": "arcade.play", "args": { "id": "${args.id}" } }
    ],
    "toggleLike": [
      {
        "set": "state.likes[${args.id}]",
        "to": "${state.likes[args.id] ? false : true}",
        "persist": "local"
      }
    ],
    "togglePin": [
      {
        "set": "state.pins[${args.id}]",
        "to": "${state.pins[args.id] ? false : true}",
        "persist": "local"
      }
    ],
    "openComments": [
      {
        "modal": {
          "title": "Comments â€” ${state.roms.find(r=>r.id===args.id)?.title || args.id}",
          "size": "lg",
          "content": {
            "type": "comments",
            "model": "state.comments[${args.id}]",
            "onSubmit": "saveComment",
            "args": { "id": "${args.id}" }
          }
        }
      }
    ],
    "saveComment": [
      {
        "push": "state.comments[${args.id}]",
        "value": { "ts": "${Date.now()}", "text": "${args.text}" },
        "persist": "local"
      }
    ]
  },

  "@wires": [
    { "when": "mounted", "do": [ { "fetch": "registry" } ] }
  ]
}
