<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>OAuth Callback</title>
  <style>body{background:#000;color:#0f0;font-family:monospace;padding:24px}</style>
</head>
<body>
<script>
  // This page is opened by the OAuth redirect with a hash like: #access_token=...&token_type=Bearer&expires_in=...
  (function(){
    try {
      const hash = location.hash.substring(1);
      const params = Object.fromEntries(hash.split('&').map(s=>s.split('=').map(decodeURIComponent)));
      const token = params['access_token'];
      if (token && window.opener) {
        window.opener.postMessage({ xjson_oauth: token }, location.origin);
        // Optionally show friendly message before auto-close
        document.body.innerHTML = '<div>Auth complete. You can safely close this window.</div>';
        setTimeout(()=> window.close(), 900);
      } else {
        document.body.innerHTML = '<div>No token found.</div>';
      }
    } catch(e){
      document.body.innerHTML = '<div>Error: '+e.message+'</div>';
    }
  })();
</script>
</body>
</html>
